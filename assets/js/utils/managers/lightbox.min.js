import {lightboxElements as a,lightboxClasses as b,media as c,} from'../../config.js';import {mediaCache as d} from'../../helpers/cache.js';import {toggleScroll as A} from'../../helpers/helper.js';import {generateMedia as f} from'../../photographer/generate/generateMedia.js';import {aria as g} from'../accessibility/aria.js';import {setupFocusCycle as h,cleanupFocusCycle as i,toggleBackgroundContent as j,blurActive as k,} from'../accessibility/focus.js';import {media as l} from'../accessibility/keyboard.js';import {createLightboxKeyboardHandler as _,createLightboxSwipeHandlers as n,createLightboxWheelHandler as o,createLightboxFocusHandler as p,initializeLightboxEvents as q,} from'../accessibility/lightbox.js';import {getSafeDuration as r} from'./animation.js';export let lightboxState=()=>a.mainModal?.classList.contains('show'),u=(_a=!1)=>{const{medias:_b,container:D,currentIndex:_d,title:E,likes:F,counter:G}=a,I=d.getOrCreate('mediaElements',H.id,()=>f(H,!0)),J=D.firstChild;if(!_b?.length||!D)return;let H=_b[_d];d.preloadAdjacent('mediaElements',_b,_d,_A=>f(_A,!0));E&&(E.textContent=H.title||'');F&&(F.textContent=H.likes||0);G&&(G.textContent=`${_d+1} / ${_b.length}`);if(J===I)return;I.classList.remove(b.visible,b.showing,b.hidden,b.transition);I.style.opacity='';if(!_a){t(I,D);I.classList.add(b.visible);return}J&&(J.style.opacity='0');I.classList.add(b.hidden,b.transition);setTimeout(()=>{t(I,D);requestAnimationFrame(()=>{I.classList.remove(b.hidden);I.classList.add(b.showing)})},r(100))},v=(aA,_B=!0)=>{if(!a.medias?.length||a.isNavigating)return;l.pauseVideo(a.container?.querySelector(c.videoElement));a.isNavigating=!0;a.currentIndex=aA;u(_B);setTimeout(()=>a.isNavigating=!1,_B?200:0)},w=()=>{a.mainModal?.classList.add('interacted');l.pauseVideo(a.container?.querySelector(c.videoElement));v(a.currentIndex+1>=a.medias.length?0:a.currentIndex+1)},x=()=>{a.mainModal?.classList.add('interacted');l.pauseVideo(a.container?.querySelector(c.videoElement));v(a.currentIndex<=0?a.medias.length-1:a.currentIndex-1)},y=aB=>{if(!a.mainModal)return;g.toggleVisibility(a.mainModal,aB,b.visible);A(aB);j(aB)},closeLightbox=()=>{if(!lightboxState())return;l.pauseVideo(a.container?.querySelector(c.videoElement));a.mainModal?.classList.add(b.closing);k();setTimeout(()=>{y(!1);a.mainModal?.classList.remove(b.closing,'interacted');i(a.mainModal)},r(100))};let t=(B,C)=>{!B.dataset.hasClickHandler&&(B.addEventListener('click',e=>e.stopPropagation()),B.dataset.hasClickHandler='true');let _c=C.firstChild;(_c&&_c!==B)&&(_c.style.opacity='',C.removeChild(_c));B.parentNode!==C&&C.appendChild(B)};export let openLightbox=(aC,aD)=>{if(!aD?.length)return;a.medias=aD;a.currentIndex=Math.max(0,aD.findIndex(m=>m.id===aC));y(!0);u(!1);h(a.mainModal,a.close,r(200))};export let initializeLightbox=()=>{if(a.isInitialized||!a.mainModal)return;let aE=n({onNext:w,onPrevious:x,minDistance:a.minDistance});q({mainModal:a.mainModal,prev:a.prev,next:a.next,close:a.close,handlers:{onPrevious:x,onNext:w,onClose:closeLightbox,onKeyboard:_({lightboxState,onClose:closeLightbox,onPrevious:x,onNext:w,onNavigate:v}),onTouchStart:e=>lightboxState()&&aE.handleStart(e),onTouchEnd:e=>lightboxState()&&aE.handleEnd(e),onWheel:o({lightboxState,onNext:w,onPrevious:x}),onFocus:p()}});a.isInitialized=!0};